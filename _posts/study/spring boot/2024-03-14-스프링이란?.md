---
categories: [study, Spring]
---

### 스프링이란?
---
- 스프링 프레임워크(Spring Framework)는 자바의 주요한 개발 프레임워크 중 하나이다.
- 스프링은 EJB의 복잡함을 해결하고자 만들어졌으며, 순수 자바 객체(POJO)를 사용하여 가벼운 코드로 기업용 애플리케이션을 개발할 수 있도록 지원한다.
- 스프링의 핵심 기능에는 의존성 주입(Dependency Injection, DI), 제어의 역전(Inversion of Control, IOC), 그리고 관점 지향 프로그래밍(Aspect Oriented Programming, AOP)이 있다.
- 위 요소들을 활용하면 느슨한 결합(Loose Coupling)을 달성할 수 있다. 이는 각각의 컴포넌트나 모듈이 서로 독립적으로 작동하고, 서로에게 영향을 덜 주면서 상호작용하는 것을 의미한다.
- 느슨한 결합을 갖는 어플리케이션은 단위 테스트를 수행하기 용이하다. 각각의 컴포넌트가 서로 독립적으로 테스트될 수 있으며, 의존성 주입(Dependency Injection)을 통해 테스트용 더미 객체를 주입하여 테스트를 수행할 수 있다. 이는 어플리케이션의 각 부분을 분리하여 테스트할 수 있으므로 전체 시스템의 안정성과 품질을 높일 수 있다.
- 대한민국에서는 기존의 스프링 프레임워크를 기반으로 한 전자정부 프레임워크를 개발하였다.

### 스프링의 핵심 개념
---
1. **의존성 주입(DI, Dependency Injection)** - 객체 간의 관계를 설정
    - 스프링은 의존성 주입을 통해 객체 간의 관계를 설정한다. 이를 통해 애플리케이션의 결합도를 낮추고 유연성과 테스트 용이성을 높일 수 있다. 예를 들어, @Autowired 어노테이션을 사용하여 객체를 주입할 수 있다.
    - 즉, new 연산자를 사용해 객체를 생성하는 것을 스프링 프레임워크가 알아서 해준다. 우리가 생성할 필요 없으니 IOC(제어의 반전)가 일어나서 스프링이 대신 만들어줄 수 있는 것이다. DI와 IOC의 두가지 개념은 같이 돌아가며 설정을 하면 스프링이 변수에다 값을 넣어준다.(Null x)

    - DI 코드를 사용하지 않은 코드의 경우, Controller는 MyService 객체에 의존하게 된다.
    - 객체의 인스턴스를 얻게 되면 객체 간의 결합도가 올라간다. 이러한 코드 작성은 단위테스트를 위한 Mock 객체를 사용할 수 없게 된다.

    ```java
    @RestController
    public class NoDIController{
    	private MyService service = new MyCerviceImpl();
	
    	@GetMapping("/hello")
    	public String getHello(){
    		 return service.getHello();
    	}
    }
    ```

    - DI를 사용하는 코드의 경우, @Service, @Autowired 어노테이션을 통해서 MyService의 인스턴스를 획득할 수 있다.
    - 단위테스트에서 MyService 객체를 Mock 객체로 대체하여 쉽게 테스트 할 수 있다.

    ```java
    public class MyService implements MyService{
    		@Override
    		public String getHello(){
    			return "Hello";
                }
    		@RestController
    		public class DIController{
    				MyService myService;
    				
    				@Autowired
    				public DIController(MyService myService){
    					this.myService = myService;				
    				}
    				
    				@GetMapping("/hello")
    				public String getHello(){
    					 return myService.getHello();
    				}
    }
    ```

2. **제어의 역전, 제어의 반전( IOC, Inversion of Control)** - IOC 컨테이너를 통해 객체의 생성과 생명주기 관리를 담당
    - 스프링은 객체의 생명 주기 및 의존성 관리를 담당하는 IOC 컨테이너를 제공한다. 개발자가 아닌 컨테이너 또는 프레임워크가 어플리케이션의 흐름과 제어를 담당하는 개념이다.
    - 개발자는 객체의 생성과 관계 설정을 스프링에 위임할 수 있다. Spring Container(`BeanFactory, ApplicationContext`)는  XML 또는 Annotation과 같은 설정 정보를 읽고, 객체의 생성, 생명주기 관리, 의존성 주입과 같은 작업을 처리한다.
    - WAS처럼 개발자가 선언만 해두면 알아서 처리해 뿌려주는 것처럼 WAS Cantainer와 유사하게 Spring Container가 알아서 처리해준다.  


3. **관점 지향 프로그래밍(AOP, Aspect Oriented Programming)** - 공통되는 기능들을 중복 없이 쉽게 적용
    - 스프링은 AOP를 지원하여 애플리케이션의 핵심 비즈니스 로직과 부가적인 기능(로깅, 트랜잭션 관리 등)을 분리하여 모듈화할 수 있다.
    - AOP는 OOP를 보완하는 수단으로, 공통되는 기능들을 모듈화하여 필요한 곳에 연결함으로써 유지보수 또는 재사용에 용이하도록 하는 것을 의미한다.
    - 공통되는 기능들을 하나의 클래스에 넣어두고 필요 시 다시 사용하며, 기존의 흐름을 끊고 특정 클래스가 실행되기 전에 다른 것들을 실행할 수 있다.
    - 예를 들어 member를 조회하는 로직과 board를 조회하는 로직은 동일하게 세션을 생성하고 close한다. sql문만 다르기 때문에 동일한 관점의 로직을 따로 떼어내서 aspect로 관리하고 자동으로 처리하는 기술이다.
    - AOP를 통해 기존 프로젝트에 다양한 기능을 로직 수정 없이 추가할 수 있다. 이런 개발 방식을 통해 결합도를 낮춘 개발이 가능하다.  


4. **POJO(Plain Old Java Object)** - EJB의 불편한 설정을 해소, 객체지향 개발의 원칙에 충실한 객체
    - 객체지향 개발의 원칙에 충실한 객체를 말하며, 특정한 제약이나 요구사항에 종속되지 않는 간단하고 순수한 자바 객체를 의미한다. 스프링은 POJO를 사용하여 객체지향 개발의 원칙에 충실한 객체를 만들 수 있도록 한다. 이를 통해 유연하고 확장 가능한 코드를 작성할 수 있다.
    - 일반적인 클래스, 우리가 만들었던 클래스는 모두 POJO로 등록할 수 있다. 클래스를 스프링에 등록하는 걸 Spring Bean이라고 한다. 스프링 객체 콩(Bean) 일반 클래스를 등록할 수 있다.  


5. **컴포넌트 스캔** - 스프링이 직접 클래스를 검색해서 빈으로 등록
    - 자동 주입과 함께 사용하는 추가 기능이 컴포넌트 스캔이다. 컴포넌트 스캔은 스프링이 직접 클래스를 검색해서 빈으로 등록해주는 기능이다.
    - **@Component** 어노테이션을 사용하여 해당 클래스를 스캔 대상으로 지정하면 스프링이 검색해서 빈으로 등록한다.
    - 설정 클래스에 빈으로 등록하지 않아도 원하는 클래스를 빈으로 등록할 수 있으므로 컴포넌트 스캔 기능을 사용하면 설정 코드가 줄어들게 된다.  


6. **웹 개발 지원**
    - 스프링은 웹 애플리케이션 개발을 위한 다양한 기능과 웹 프레젠테이션 계층을 제공한다.
    - 스프링 MVC는 유연하고 확장 가능한 웹 애플리케이션을 개발할 수 있는 MVC(Model-View-Controller) 아키텍처를 지원한다.


### 3. 스프링 프레임워크의 표적 모듈

- 스프링 프레임워크는 다양한 기능이 존재, 그 기능들은 약 20개의 모듈로 구성되어 있다.
- 많이 사용되는 대표적인 모듈: Spring JDBC, Spring MVC, Spring AOP, Spring ORM, Spring Test, Spring Expression Language(SpEL)
- **스프링 구성 모듈**

![이미지](/assets/img/study/spring/%EC%8A%A4%ED%94%84%EB%A7%81(1).png)

- spring JDBC : Mybatis나 Hibernate 등을 연결하는 모듈
- spring MVC : 웹 프로젝트 MVC 패턴2로 만들 때 사용하는 모듈
- PSA : 스프링에서 제공하지 않은 다른 모듈들을 사용할 때 의존성을 없애주는 추상화 기능을 제공
- Test : JUnit이라고 한다. mock 객체를 만들어서 가상으로 돌아가는지 테스트 서버(Mock Server)를 돌린다.
- Data 접근 계층 : 영속성 프레임 워크 연결
- MVC 계층 : 서블릿을 연결
- AOP 계층 : 공통된 코드를 빼내어 특정 메소드나 클래스 시점에서 흐름을 이어가게 한다.
- Core Container : 스프링 Bean을 제어, Spring의 핵심 부분

| 모듈 명 | 내용 |
| --- | --- |
| spring-beans | 스프링 컨테이너를 이용해서 객체를 생성하는 기본 기능 제공 |
| spring-context | 객체 생성, 라이프 사이클 처리, 스키마의 확장 등의 기능 제공 |
| spring-aop | AOP 기능 제공 |
| spring-web | REST클라이언트 데이터 변환 처리, 서블릿 필터, 파일 업로드 지원 등 웹 개발에 필요한 기반 기능 제공 |
| spring-webmvc | 스프링 기반의 MVC 프레임워크, 웹 어플리케이션을 개발하는데 필요한 컨트롤러, 뷰 구현 제공 |
| spring-websocket | 스프링 MVC에서 웹 소켓 연동을 처리할 수 있도록 제공 |
| spring-oxm | XML과 자바 객체 간의 매핑을 처리하기 위한 API 제공 |
| spring-tx | 트랜잭션 처리를 위한 추상 레이어 제공 |
| spring-jdbc | JDBC프로그래밍을 보다 쉽게 할 수 있는 템플릿 제공 |
| spring-orm | Hibernate, JPA, MyBatis 등과의 연동 지원 |
| spring-jms | JMS 서버와 메시지를 쉽게 주고 받을 수 있도록 하기 위한 템플릿 |
| spring-context-support | 스케줄링, 메일발송, 캐시연동, 벨로시티 등 부가기능 제공 |

### 1. **빈 라이프사이클과 범위**

1. **컨테이너 초기화와 종료**
    - 컨테이너 초기화:
        - 스프링 컨테이너의 초기화는 컨텍스트 객체를 생성할 때 발생한다.
        - 스프링 컨테이너는 설정 클래스에서 정보를 읽어와 알맞은 빈 객체를 생성하고 각 빈을 연결하는 작업을 수행한다.
    - 컨테이너의 사용:
        - **`getBean()`**과 같은 메서드를 이용해서 컨테이너에 보관된 빈 객체를 구한다.
    - 컨테이너의 종료:
        - 종료 메서드인 **`close()`**를 호출하여 컨테이너를 종료한다.
        - **`close()`** 메서드는 **`AbstractApplicationContext`** 클래스에 정의되어 있다.
        - 자바 설정을 사용하는 **`AnnotationConfigApplicationContext`** 클래스나 XML 설정을 사용하는 **`GenericXmlApplicationContext`** 클래스는 모두 **`AbstractApplicationContext`**를 상속받는다.
        
2. **스프링 빈 객체의 라이프 사이클**
    - 스프링 컨테이너는 빈 객체의 라이프 사이클을 관리한다.
    - 초기화:
        - 빈 객체 생성 및 의존 설정이 이루어지고, 의존 자동 주입을 통한 의존 설정이 이 시점에서 수행된다.
    - 초기화 메서드 호출:
        - 모든 의존 설정이 완료되면 빈 객체의 초기화를 수행한다. 이때 스프링은 빈 객체의 지정된 초기화 메서드를 호출한다.
    - 소멸:
        - 스프링 컨테이너를 종료하면 빈 객체의 소멸을 처리한다. 이때에도 지정된 메서드를 호출하여 빈 객체를 소멸시킨다.
        


<br>    
    스프링 컨테이너는 빈 객체와 빈 이름을 연결하는 정보를 가지며, 빈 객체의 생성, 초기화, 보관, 제거 등을 관리한다. **`ApplicationContext`** (또는 **`BeanFactory`**)는 이러한 기능을 수행하며, 컨테이너라고도 부른다. **`AnnotationConfigApplicationContext`** 클래스는 **`ApplicationContext`** 인터페이스를 구현한 클래스 중 하나로, 자바 클래스에서 정보를 읽어와 객체 생성과 초기화를 수행한다.